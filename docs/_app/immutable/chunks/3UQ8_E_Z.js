const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_app/immutable/chunks/Mxg7T9gF.js","_app/immutable/chunks/Ec70zE_B.js","_app/immutable/chunks/OJeCUhsT.js","_app/immutable/chunks/cKyewg4w.js","_app/immutable/chunks/CNFkYgts.js","_app/immutable/chunks/CiA1t1la.js","_app/immutable/chunks/Deo5WI26.js","_app/immutable/chunks/DdoEkQkS.js","_app/immutable/chunks/DvmDE4i0.js","_app/immutable/chunks/BM4E3ydK.js","_app/immutable/chunks/D0UzvsAP.js","_app/immutable/chunks/Bd4nbmiO.js"])))=>i.map(i=>d[i]);
import{_ as B}from"./Deo5WI26.js";import{ag as te,T,O,ah as V,h as C,A as se,ai as D,aj as z,ak as ne,al as re,R as ae,r as ie,u as oe,am as S,an as le,M as J,ao as he,x as K,ap as de,a2 as ce,aq as ue,ar as fe,l as P,m as R,Q as F,I as _e,J as pe,as as me,at as ye,V as m,au as be,C as U,av as ge,y as A,aw as Ae,ax as ve,ay as Ce,k as H,az as Me}from"./Mxg7T9gF.js";import{a as G}from"./D0UzvsAP.js";class Ee{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise((t,e)=>{this._resolve=t,this._reject=e})}}class W{constructor(t){this.byteOffset=0,this.buffer=t}async loadAsync(t){const e=await this.buffer.readAsync(this.byteOffset,t);this._dataView=new DataView(e.buffer,e.byteOffset,e.byteLength),this._dataByteOffset=0}readUint32(){const t=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,t}readUint8Array(t){const e=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,t);return this._dataByteOffset+=t,this.byteOffset+=t,e}readString(t){return te(this.readUint8Array(t))}skipBytes(t){this._dataByteOffset+=t,this.byteOffset+=t}}class X{constructor(t){this._factory=t}get value(){return this._factory&&(this._value=this._factory(),this._factory=void 0),this._value}}function j(u,t,e,s){const n={externalResourceFunction:s};return e&&(n.uri=t==="file:"?e:t+e),ArrayBuffer.isView(u)?GLTFValidator.validateBytes(u,n):GLTFValidator.validateString(u,n)}function we(){const u=[];onmessage=t=>{const e=t.data;switch(e.id){case"init":{importScripts(e.url);break}case"validate":{j(e.data,e.rootUrl,e.fileName,s=>new Promise((n,r)=>{const a=u.length;u.push({resolve:n,reject:r}),postMessage({id:"getExternalResource",index:a,uri:s})})).then(s=>{postMessage({id:"validate.resolve",value:s})},s=>{postMessage({id:"validate.reject",reason:s})});break}case"getExternalResource.resolve":{u[e.index].resolve(e.value);break}case"getExternalResource.reject":{u[e.index].reject(e.reason);break}}}}class Q{static ValidateAsync(t,e,s,n){return typeof Worker=="function"?new Promise((r,a)=>{const i=`${j}(${we})()`,o=URL.createObjectURL(new Blob([i],{type:"application/javascript"})),l=new Worker(o),h=c=>{l.removeEventListener("error",h),l.removeEventListener("message",d),a(c)},d=c=>{const p=c.data;switch(p.id){case"getExternalResource":{n(p.uri).then(_=>{l.postMessage({id:"getExternalResource.resolve",index:p.index,value:_},[_.buffer])},_=>{l.postMessage({id:"getExternalResource.reject",index:p.index,reason:_})});break}case"validate.resolve":{l.removeEventListener("error",h),l.removeEventListener("message",d),r(p.value),l.terminate();break}case"validate.reject":l.removeEventListener("error",h),l.removeEventListener("message",d),a(p.reason),l.terminate()}};if(l.addEventListener("error",h),l.addEventListener("message",d),l.postMessage({id:"init",url:T.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(t)){const c=t.slice();l.postMessage({id:"validate",data:c,rootUrl:e,fileName:s},[c.buffer])}else l.postMessage({id:"validate",data:t,rootUrl:e,fileName:s})}):(this._LoadScriptPromise||(this._LoadScriptPromise=T.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then(()=>j(t,e,s,n)))}}Q.Configuration={url:`${T._DefaultCdnUrl}/gltf_validator.js`};function q(u,t,e){try{return Promise.resolve(new Uint8Array(u,t,e))}catch(s){return Promise.reject(s)}}function Oe(u,t,e){try{if(t<0||t>=u.byteLength)throw new RangeError("Offset is out of range.");if(t+e>u.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(u.buffer,u.byteOffset+t,e))}catch(s){return Promise.reject(s)}}var N;(function(u){u[u.AUTO=0]="AUTO",u[u.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"})(N||(N={}));var I;(function(u){u[u.NONE=0]="NONE",u[u.FIRST=1]="FIRST",u[u.ALL=2]="ALL"})(I||(I={}));var E;(function(u){u[u.LOADING=0]="LOADING",u[u.READY=1]="READY",u[u.COMPLETE=2]="COMPLETE"})(E||(E={}));class Z{constructor(){this.alwaysComputeBoundingBox=!1,this.alwaysComputeSkeletonRootNode=!1,this.animationStartMode=I.FIRST,this.compileMaterials=!1,this.compileShadowGenerators=!1,this.coordinateSystemMode=N.AUTO,this.createInstances=!0,this.loadAllMaterials=!1,this.loadMorphTargets=!0,this.loadNodeAnimations=!0,this.loadOnlyMaterials=!1,this.loadSkins=!0,this.skipMaterials=!1,this.targetFps=60,this.transparencyAsCoverage=!1,this.useClipPlane=!1,this.useGltfTextureNames=!1,this.useRangeRequests=!1,this.useSRGBBuffers=!0,this.validate=!1,this.useOpenPBR=!1,this.dontUseTransmissionHelper=!1}}const xe=new Z;class Se extends Z{constructor(){super(...arguments),this.extensionOptions={},this.preprocessUrlAsync=t=>Promise.resolve(t)}copyFrom(t){t&&(this.alwaysComputeBoundingBox=t.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.alwaysComputeSkeletonRootNode=t.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.animationStartMode=t.animationStartMode??this.animationStartMode,this.capturePerformanceCounters=t.capturePerformanceCounters??this.capturePerformanceCounters,this.compileMaterials=t.compileMaterials??this.compileMaterials,this.compileShadowGenerators=t.compileShadowGenerators??this.compileShadowGenerators,this.coordinateSystemMode=t.coordinateSystemMode??this.coordinateSystemMode,this.createInstances=t.createInstances??this.createInstances,this.customRootNode=t.customRootNode,this.extensionOptions=t.extensionOptions??this.extensionOptions,this.loadAllMaterials=t.loadAllMaterials??this.loadAllMaterials,this.loadMorphTargets=t.loadMorphTargets??this.loadMorphTargets,this.loadNodeAnimations=t.loadNodeAnimations??this.loadNodeAnimations,this.loadOnlyMaterials=t.loadOnlyMaterials??this.loadOnlyMaterials,this.loadSkins=t.loadSkins??this.loadSkins,this.loggingEnabled=t.loggingEnabled??this.loggingEnabled,this.onCameraLoaded=t.onCameraLoaded,this.onMaterialLoaded=t.onMaterialLoaded,this.onMeshLoaded=t.onMeshLoaded,this.onParsed=t.onParsed,this.onSkinLoaded=t.onSkinLoaded,this.onTextureLoaded=t.onTextureLoaded,this.onValidated=t.onValidated,this.preprocessUrlAsync=t.preprocessUrlAsync??this.preprocessUrlAsync,this.skipMaterials=t.skipMaterials??this.skipMaterials,this.targetFps=t.targetFps??this.targetFps,this.transparencyAsCoverage=t.transparencyAsCoverage??this.transparencyAsCoverage,this.useClipPlane=t.useClipPlane??this.useClipPlane,this.useGltfTextureNames=t.useGltfTextureNames??this.useGltfTextureNames,this.useOpenPBR=t.useOpenPBR??this.useOpenPBR,this.useRangeRequests=t.useRangeRequests??this.useRangeRequests,this.useSRGBBuffers=t.useSRGBBuffers??this.useSRGBBuffers,this.validate=t.validate??this.validate,this.dontUseTransmissionHelper=t.dontUseTransmissionHelper??this.dontUseTransmissionHelper)}}class w extends Se{constructor(t){super(),this.onParsedObservable=new O,this.onMeshLoadedObservable=new O,this.onSkinLoadedObservable=new O,this.onTextureLoadedObservable=new O,this.onMaterialLoadedObservable=new O,this.onCameraLoadedObservable=new O,this.onCompleteObservable=new O,this.onErrorObservable=new O,this.onDisposeObservable=new O,this.onExtensionLoadedObservable=new O,this.onValidatedObservable=new O,this._loader=null,this._state=null,this._requests=new Array,this.name=V.name,this.extensions=V.extensions,this.onLoaderStateChangedObservable=new O,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.copyFrom(Object.assign({...xe},t))}set onParsed(t){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),t&&(this._onParsedObserver=this.onParsedObservable.add(t))}set onMeshLoaded(t){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),t&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(t))}set onSkinLoaded(t){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),t&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add(e=>t(e.node,e.skinnedNode)))}set onTextureLoaded(t){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),t&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(t))}set onMaterialLoaded(t){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),t&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(t))}set onCameraLoaded(t){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),t&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(t))}set onComplete(t){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(t)}set onError(t){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(t)}set onDispose(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)}set onExtensionLoaded(t){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(t)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(t){this._loggingEnabled!==t&&(this._loggingEnabled=t,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(t){this._capturePerformanceCounters!==t&&(this._capturePerformanceCounters=t,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(t){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(t)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const t of this._requests)t.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=t=>Promise.resolve(t),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()}loadFile(t,e,s,n,r,a,i,o){if(ArrayBuffer.isView(e))return this._loadBinary(t,e,s,n,i,o),null;this._progressCallback=r;const l=e.name||T.GetFilename(e);if(a){if(this.useRangeRequests){this.validate&&C.Warn("glTF validation is not supported when range requests are enabled");const h={abort:()=>{},onCompleteObservable:new O},d={readAsync:(c,p)=>new Promise((_,v)=>{this._loadFile(t,e,g=>{_(new Uint8Array(g))},!0,g=>{v(g)},g=>{g.setRequestHeader("Range",`bytes=${c}-${c+p-1}`)})}),byteLength:0};return this._unpackBinaryAsync(new W(d)).then(c=>{h.onCompleteObservable.notifyObservers(h),n(c)},i?c=>i(void 0,c):void 0),h}return this._loadFile(t,e,h=>{this._validate(t,new Uint8Array(h,0,h.byteLength),s,l),this._unpackBinaryAsync(new W({readAsync:(d,c)=>q(h,d,c),byteLength:h.byteLength})).then(d=>{n(d)},i?d=>i(void 0,d):void 0)},!0,i)}else return this._loadFile(t,e,h=>{try{this._validate(t,h,s,l),n({json:this._parseJson(h)})}catch{i&&i()}},!1,i)}_loadBinary(t,e,s,n,r,a){this._validate(t,new Uint8Array(e.buffer,e.byteOffset,e.byteLength),s,a),this._unpackBinaryAsync(new W({readAsync:(i,o)=>Oe(e,i,o),byteLength:e.byteLength})).then(i=>{n(i)},r?i=>r(void 0,i):void 0)}importMeshAsync(t,e,s,n,r,a){return Promise.resolve().then(()=>(this.onParsedObservable.notifyObservers(s),this.onParsedObservable.clear(),this._log(`Loading ${a||""}`),this._loader=this._getLoader(s),this._loader.importMeshAsync(t,e,null,s,n,r,a)))}loadAsync(t,e,s,n,r){return Promise.resolve().then(()=>(this.onParsedObservable.notifyObservers(e),this.onParsedObservable.clear(),this._log(`Loading ${r||""}`),this._loader=this._getLoader(e),this._loader.loadAsync(t,e,s,n,r)))}loadAssetContainerAsync(t,e,s,n,r){return Promise.resolve().then(()=>{this.onParsedObservable.notifyObservers(e),this.onParsedObservable.clear(),this._log(`Loading ${r||""}`),this._loader=this._getLoader(e);const a=new se(t),i=[];this.onMaterialLoadedObservable.add(d=>{i.push(d)});const o=[];this.onTextureLoadedObservable.add(d=>{o.push(d)});const l=[];this.onCameraLoadedObservable.add(d=>{l.push(d)});const h=[];return this.onMeshLoadedObservable.add(d=>{d.morphTargetManager&&h.push(d.morphTargetManager)}),this._loader.importMeshAsync(null,t,a,e,s,n,r).then(d=>(Array.prototype.push.apply(a.geometries,d.geometries),Array.prototype.push.apply(a.meshes,d.meshes),Array.prototype.push.apply(a.particleSystems,d.particleSystems),Array.prototype.push.apply(a.skeletons,d.skeletons),Array.prototype.push.apply(a.animationGroups,d.animationGroups),Array.prototype.push.apply(a.materials,i),Array.prototype.push.apply(a.textures,o),Array.prototype.push.apply(a.lights,d.lights),Array.prototype.push.apply(a.transformNodes,d.transformNodes),Array.prototype.push.apply(a.cameras,l),Array.prototype.push.apply(a.morphTargetManagers,h),a))})}canDirectLoad(t){return V.canDirectLoad(t)}directLoad(t,e){if(e.startsWith("base64,"+D)||e.startsWith(";base64,"+D)||e.startsWith("application/octet-stream;base64,"+D)||e.startsWith("model/gltf-binary;base64,"+D)){const s=z(e);return this._validate(t,new Uint8Array(s,0,s.byteLength)),this._unpackBinaryAsync(new W({readAsync:(n,r)=>q(s,n,r),byteLength:s.byteLength}))}return this._validate(t,e),Promise.resolve({json:this._parseJson(e)})}createPlugin(t){return new w(t[V.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise((t,e)=>{this.onCompleteObservable.addOnce(()=>{t()}),this.onErrorObservable.addOnce(s=>{e(s)})})}_setState(t){this._state!==t&&(this._state=t,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(E[this._state]))}_loadFile(t,e,s,n,r,a){const i=t._loadFile(e,s,o=>{this._onProgress(o,i)},!0,n,r,a);return i.onCompleteObservable.add(()=>{i._lengthComputable=!0,i._total=i._loaded}),this._requests.push(i),i}_onProgress(t,e){if(!this._progressCallback)return;e._lengthComputable=t.lengthComputable,e._loaded=t.loaded,e._total=t.total;let s=!0,n=0,r=0;for(const a of this._requests){if(a._lengthComputable===void 0||a._loaded===void 0||a._total===void 0)return;s=s&&a._lengthComputable,n+=a._loaded,r+=a._total}this._progressCallback({lengthComputable:s,loaded:n,total:s?r:0})}_validate(t,e,s="",n=""){this.validate&&(this._startPerformanceCounter("Validate JSON"),Q.ValidateAsync(e,s,n,r=>this.preprocessUrlAsync(s+r).then(a=>t._loadFileAsync(a,void 0,!0,!0).then(i=>new Uint8Array(i,0,i.byteLength)))).then(r=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(r),this.onValidatedObservable.clear()},r=>{this._endPerformanceCounter("Validate JSON"),T.Warn(`Failed to validate: ${r.message}`),this.onValidatedObservable.clear()}))}_getLoader(t){const e=t.json.asset||{};this._log(`Asset version: ${e.version}`),e.minVersion&&this._log(`Asset minimum version: ${e.minVersion}`),e.generator&&this._log(`Asset generator: ${e.generator}`);const s=w._parseVersion(e.version);if(!s)throw new Error("Invalid version: "+e.version);if(e.minVersion!==void 0){const a=w._parseVersion(e.minVersion);if(!a)throw new Error("Invalid minimum version: "+e.minVersion);if(w._compareVersion(a,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+e.minVersion)}const r={1:w._CreateGLTF1Loader,2:w._CreateGLTF2Loader}[s.major];if(!r)throw new Error("Unsupported version: "+e.version);return r(this)}_parseJson(t){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${t.length}`);const e=JSON.parse(t);return this._endPerformanceCounter("Parse JSON"),e}_unpackBinaryAsync(t){return this._startPerformanceCounter("Unpack Binary"),t.loadAsync(20).then(()=>{const e={Magic:1179937895},s=t.readUint32();if(s!==e.Magic)throw new ne("Unexpected magic: "+s,re.GLTFLoaderUnexpectedMagicError);const n=t.readUint32();this.loggingEnabled&&this._log(`Binary version: ${n}`);const r=t.readUint32();!this.useRangeRequests&&r!==t.buffer.byteLength&&C.Warn(`Length in header does not match actual data length: ${r} != ${t.buffer.byteLength}`);let a;switch(n){case 1:{a=this._unpackBinaryV1Async(t,r);break}case 2:{a=this._unpackBinaryV2Async(t,r);break}default:throw new Error("Unsupported version: "+n)}return this._endPerformanceCounter("Unpack Binary"),a})}_unpackBinaryV1Async(t,e){const s={JSON:0},n=t.readUint32(),r=t.readUint32();if(r!==s.JSON)throw new Error(`Unexpected content format: ${r}`);const a=e-t.byteOffset,i={json:this._parseJson(t.readString(n)),bin:null};if(a!==0){const o=t.byteOffset;i.bin={readAsync:(l,h)=>t.buffer.readAsync(o+l,h),byteLength:a}}return Promise.resolve(i)}_unpackBinaryV2Async(t,e){const s={JSON:1313821514,BIN:5130562},n=t.readUint32();if(t.readUint32()!==s.JSON)throw new Error("First chunk format is not JSON");return t.byteOffset+n===e?t.loadAsync(n).then(()=>({json:this._parseJson(t.readString(n)),bin:null})):t.loadAsync(n+8).then(()=>{const a={json:this._parseJson(t.readString(n)),bin:null},i=()=>{const o=t.readUint32();switch(t.readUint32()){case s.JSON:throw new Error("Unexpected JSON chunk");case s.BIN:{const h=t.byteOffset;a.bin={readAsync:(d,c)=>t.buffer.readAsync(h+d,c),byteLength:o},t.skipBytes(o);break}default:{t.skipBytes(o);break}}return t.byteOffset!==e?t.loadAsync(8).then(i):Promise.resolve(a)};return i()})}static _parseVersion(t){if(t==="1.0"||t==="1.0.1")return{major:1,minor:0};const e=(t+"").match(/^(\d+)\.(\d+)/);return e?{major:parseInt(e[1]),minor:parseInt(e[2])}:null}static _compareVersion(t,e){return t.major>e.major?1:t.major<e.major?-1:t.minor>e.minor?1:t.minor<e.minor?-1:0}_logOpen(t){this._log(t),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(t){const e=w._logSpaces.substring(0,this._logIndentLevel*2);C.Log(`${e}${t}`)}_logDisabled(t){}_startPerformanceCounterEnabled(t){T.StartPerformanceCounter(t)}_startPerformanceCounterDisabled(t){}_endPerformanceCounterEnabled(t){T.EndPerformanceCounter(t)}_endPerformanceCounterDisabled(t){}}w.IncrementalLoading=!0;w.HomogeneousCoordinates=!1;w._logSpaces="                                ";ae(new w);const Pe=new X(()=>B(()=>import("./Mxg7T9gF.js").then(u=>u.aB),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),Te=new X(()=>B(()=>import("./BM4E3ydK.js"),__vite__mapDeps([9,0,1,2,3,4,5,6,7,8,10])));class f{static Get(t,e,s){if(!e||s==null||!e[s])throw new Error(`${t}: Failed to find index (${s})`);return e[s]}static TryGet(t,e){return!t||e==null||!t[e]?null:t[e]}static Assign(t){if(t)for(let e=0;e<t.length;e++)t[e].index=e}}function Y(u){if(u.min&&u.max){const t=u.min,e=u.max,s=H.Vector3[0].copyFromFloats(t[0],t[1],t[2]),n=H.Vector3[1].copyFromFloats(e[0],e[1],e[2]);if(u.normalized&&u.componentType!==5126){let r=1;switch(u.componentType){case 5120:r=127;break;case 5121:r=255;break;case 5122:r=32767;break;case 5123:r=65535;break}const a=1/r;s.scaleInPlace(a),n.scaleInPlace(a)}return new Me(s,n)}return null}class y{static RegisterExtension(t,e){ie(t,!1,e)}static UnregisterExtension(t){return oe(t)}get gltf(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(t){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._materialAdapterCache=new WeakMap,this._pbrMaterialImpl=null,this._parent=t}_getOrCreateMaterialAdapter(t){let e=this._materialAdapterCache.get(t);if(!e){if(this._pbrMaterialImpl)e=new this._pbrMaterialImpl.adapterClass(t);else throw new Error("Appropriate material adapter class not found");this._materialAdapterCache.set(t,e)}return e}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach(t=>t.dispose&&t.dispose()),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(t,e,s,n,r,a,i=""){return await Promise.resolve().then(async()=>{this._babylonScene=e,this._assetContainer=s,this._loadData(n);let o=null;if(t){const l={};if(this._gltf.nodes)for(const d of this._gltf.nodes)d.name&&(l[d.name]=d.index);o=(t instanceof Array?t:[t]).map(d=>{const c=l[d];if(c===void 0)throw new Error(`Failed to find node '${d}'`);return c})}return await this._loadAsync(r,i,o,()=>({meshes:this._getMeshes(),particleSystems:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]}))})}async loadAsync(t,e,s,n,r=""){return this._babylonScene=t,this._loadData(e),await this._loadAsync(s,r,null,()=>{})}async _loadAsync(t,e,s,n){return await Promise.resolve().then(async()=>{this._rootUrl=t,this._uniqueRootUrl=!t.startsWith("file:")&&e?t:`${t}${Date.now()}/`,this._fileName=e,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync(),!this.parent.skipMaterials&&this._pbrMaterialImpl==null&&(this.parent.useOpenPBR||this.isExtensionUsed("KHR_materials_openpbr")?this._pbrMaterialImpl={materialClass:(await B(async()=>{const{OpenPBRMaterial:h}=await import("./Mxg7T9gF.js").then(d=>d.bm);return{OpenPBRMaterial:h}},__vite__mapDeps([0,1,2,3,4,5,6,7,8]))).OpenPBRMaterial,adapterClass:(await B(async()=>{const{OpenPBRMaterialLoadingAdapter:h}=await import("./DUmKUa7I.js");return{OpenPBRMaterialLoadingAdapter:h}},[])).OpenPBRMaterialLoadingAdapter}:this._pbrMaterialImpl={materialClass:(await B(async()=>{const{PBRMaterial:h}=await import("./Mxg7T9gF.js").then(d=>d.bl);return{PBRMaterial:h}},__vite__mapDeps([0,1,2,3,4,5,6,7,8]))).PBRMaterial,adapterClass:(await B(async()=>{const{PBRMaterialLoadingAdapter:h}=await import("./Bd4nbmiO.js");return{PBRMaterialLoadingAdapter:h}},__vite__mapDeps([11,0,1,2,3,4,5,6,7,8]))).PBRMaterialLoadingAdapter});const r=`${E[E.LOADING]} => ${E[E.READY]}`,a=`${E[E.LOADING]} => ${E[E.COMPLETE]}`;this._parent._startPerformanceCounter(r),this._parent._startPerformanceCounter(a),this._parent._setState(E.LOADING),this._extensionsOnLoading();const i=new Array,o=this._babylonScene.blockMaterialDirtyMechanism;if(this._babylonScene.blockMaterialDirtyMechanism=!0,!this.parent.loadOnlyMaterials){if(s)i.push(this.loadSceneAsync("/nodes",{nodes:s,index:-1}));else if(this._gltf.scene!=null||this._gltf.scenes&&this._gltf.scenes[0]){const h=f.Get("/scene",this._gltf.scenes,this._gltf.scene||0);i.push(this.loadSceneAsync(`/scenes/${h.index}`,h))}}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let h=0;h<this._gltf.materials.length;++h){const d=this._gltf.materials[h],c="/materials/"+h,p=S.TriangleFillMode;i.push(this._loadMaterialAsync(c,d,null,p,()=>{}))}return this._allMaterialsDirtyRequired?this._babylonScene.blockMaterialDirtyMechanism=o:this._babylonScene._forceBlockMaterialDirtyMechanism(o),this._parent.compileMaterials&&i.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&i.push(this._compileShadowGeneratorsAsync()),await Promise.all(i).then(()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.setEnabled(!0);for(const h of this._babylonScene.materials){const d=h;d.maxSimultaneousLights!==void 0&&(d.maxSimultaneousLights=Math.max(d.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(E.READY),this._skipStartAnimationStep||this._startAnimations(),n()}).then(h=>(this._parent._endPerformanceCounter(r),T.SetImmediate(()=>{this._disposed||Promise.all(this._completePromises).then(()=>{this._parent._endPerformanceCounter(a),this._parent._setState(E.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()},d=>{this._parent.onErrorObservable.notifyObservers(d),this._parent.onErrorObservable.clear(),this.dispose()})}),h))}).catch(r=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(r),this._parent.onErrorObservable.clear(),this.dispose()),r})}_loadData(t){if(this._gltf=t.json,this._setupData(),t.bin){const e=this._gltf.buffers;if(e&&e[0]&&!e[0].uri){const s=e[0];(s.byteLength<t.bin.byteLength-3||s.byteLength>t.bin.byteLength)&&C.Warn(`Binary buffer length (${s.byteLength}) from JSON does not match chunk length (${t.bin.byteLength})`),this._bin=t.bin}else C.Warn("Unexpected BIN chunk")}}_setupData(){if(f.Assign(this._gltf.accessors),f.Assign(this._gltf.animations),f.Assign(this._gltf.buffers),f.Assign(this._gltf.bufferViews),f.Assign(this._gltf.cameras),f.Assign(this._gltf.images),f.Assign(this._gltf.materials),f.Assign(this._gltf.meshes),f.Assign(this._gltf.nodes),f.Assign(this._gltf.samplers),f.Assign(this._gltf.scenes),f.Assign(this._gltf.skins),f.Assign(this._gltf.textures),this._gltf.nodes){const t={};for(const s of this._gltf.nodes)if(s.children)for(const n of s.children)t[n]=s.index;const e=this._createRootNode();for(const s of this._gltf.nodes){const n=t[s.index];s.parent=n===void 0?e:this._gltf.nodes[n]}}}async _loadExtensionsAsync(){const t=[];if(le.forEach((e,s)=>{this.parent.extensionOptions[s]?.enabled===!1?e.isGLTFExtension&&this.isExtensionUsed(s)&&C.Warn(`Extension ${s} is used but has been explicitly disabled.`):(!e.isGLTFExtension||this.isExtensionUsed(s))&&t.push((async()=>{const n=await e.factory(this);return n.name!==s&&C.Warn(`The name of the glTF loader extension instance does not match the registered name: ${n.name} !== ${s}`),this._parent.onExtensionLoadedObservable.notifyObservers(n),n})())}),this._extensions.push(...await Promise.all(t)),this._extensions.sort((e,s)=>(e.order||Number.MAX_VALUE)-(s.order||Number.MAX_VALUE)),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired){for(const e of this._gltf.extensionsRequired)if(!this._extensions.some(n=>n.name===e&&n.enabled))throw this.parent.extensionOptions[e]?.enabled===!1?new Error(`Required extension ${e} is disabled`):new Error(`Required extension ${e} is not available`)}}_createRootNode(){if(this._parent.customRootNode!==void 0)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:this._rootBabylonMesh===null?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new J("__root__",this._babylonScene);this._rootBabylonMesh=t,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);const e={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case N.AUTO:{this._babylonScene.useRightHandedSystem||(e.rotation=[0,1,0,0],e.scale=[1,1,-1],y._LoadTransform(e,this._rootBabylonMesh));break}case N.FORCE_RIGHT_HANDED:{this._babylonScene.useRightHandedSystem=!0;break}default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(t),e}loadSceneAsync(t,e){const s=this._extensionsLoadSceneAsync(t,e);if(s)return s;const n=new Array;if(this.logOpen(`${t} ${e.name||""}`),e.nodes)for(const r of e.nodes){const a=f.Get(`${t}/nodes/${r}`,this._gltf.nodes,r);n.push(this.loadNodeAsync(`/nodes/${a.index}`,a,i=>{i.parent=this._rootBabylonMesh}))}for(const r of this._postSceneLoadActions)r();return n.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(n).then(()=>{})}_forEachPrimitive(t,e){if(t._primitiveBabylonMeshes)for(const s of t._primitiveBabylonMeshes)e(s)}_getGeometries(){const t=[],e=this._gltf.nodes;if(e)for(const s of e)this._forEachPrimitive(s,n=>{const r=n.geometry;r&&t.indexOf(r)===-1&&t.push(r)});return t}_getMeshes(){const t=[];this._rootBabylonMesh instanceof he&&t.push(this._rootBabylonMesh);const e=this._gltf.nodes;if(e)for(const s of e)this._forEachPrimitive(s,n=>{t.push(n)});return t}_getTransformNodes(){const t=[],e=this._gltf.nodes;if(e)for(const s of e)s._babylonTransformNode&&s._babylonTransformNode.getClassName()==="TransformNode"&&t.push(s._babylonTransformNode),s._babylonTransformNodeForSkin&&t.push(s._babylonTransformNodeForSkin);return t}_getSkeletons(){const t=[],e=this._gltf.skins;if(e)for(const s of e)s._data&&t.push(s._data.babylonSkeleton);return t}_getAnimationGroups(){const t=[],e=this._gltf.animations;if(e)for(const s of e)s._babylonAnimationGroup&&t.push(s._babylonAnimationGroup);return t}_startAnimations(){switch(this._parent.animationStartMode){case I.NONE:break;case I.FIRST:{const t=this._getAnimationGroups();t.length!==0&&t[0].start(!0);break}case I.ALL:{const t=this._getAnimationGroups();for(const e of t)e.start(!0);break}default:{C.Error(`Invalid animation start mode (${this._parent.animationStartMode})`);return}}}loadNodeAsync(t,e,s=()=>{}){const n=this._extensionsLoadNodeAsync(t,e,s);if(n)return n;if(e._babylonTransformNode)throw new Error(`${t}: Invalid recursive node hierarchy`);const r=new Array;this.logOpen(`${t} ${e.name||""}`);const a=l=>{if(y.AddPointerMetadata(l,t),y._LoadTransform(e,l),e.camera!=null){const h=f.Get(`${t}/camera`,this._gltf.cameras,e.camera);r.push(this.loadCameraAsync(`/cameras/${h.index}`,h,d=>{d.parent=l,this._babylonScene.useRightHandedSystem||(l.scaling.x=-1)}))}if(e.children)for(const h of e.children){const d=f.Get(`${t}/children/${h}`,this._gltf.nodes,h);r.push(this.loadNodeAsync(`/nodes/${d.index}`,d,c=>{c.parent=l}))}s(l)},i=e.mesh!=null,o=this._parent.loadSkins&&e.skin!=null;if(!i||o){const l=e.name||`node${e.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new K(l,this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e.mesh==null?e._babylonTransformNode=h:e._babylonTransformNodeForSkin=h,a(h)}if(i)if(o){const l=f.Get(`${t}/mesh`,this._gltf.meshes,e.mesh);r.push(this._loadMeshAsync(`/meshes/${l.index}`,e,l,h=>{const d=e._babylonTransformNodeForSkin;h.metadata=de(d.metadata,h.metadata||{});const c=f.Get(`${t}/skin`,this._gltf.skins,e.skin);r.push(this._loadSkinAsync(`/skins/${c.index}`,e,c,p=>{this._forEachPrimitive(e,_=>{_.skeleton=p}),this._postSceneLoadActions.push(()=>{if(c.skeleton!=null){const _=f.Get(`/skins/${c.index}/skeleton`,this._gltf.nodes,c.skeleton).parent;e.index===_.index?h.parent=d.parent:h.parent=_._babylonTransformNode}else h.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:d,skinnedNode:h})})}))}))}else{const l=f.Get(`${t}/mesh`,this._gltf.meshes,e.mesh);r.push(this._loadMeshAsync(`/meshes/${l.index}`,e,l,a))}return this.logClose(),Promise.all(r).then(()=>(this._forEachPrimitive(e,l=>{const h=l;!h.isAnInstance&&h.geometry&&h.geometry.useBoundingInfoFromGeometry?l._updateBoundingInfo():l.refreshBoundingInfo(!0,!0)}),e._babylonTransformNode))}_loadMeshAsync(t,e,s,n){const r=s.primitives;if(!r||!r.length)throw new Error(`${t}: Primitives are missing`);r[0].index==null&&f.Assign(r);const a=new Array;this.logOpen(`${t} ${s.name||""}`);const i=e.name||`node${e.index}`;if(r.length===1){const o=s.primitives[0];a.push(this._loadMeshPrimitiveAsync(`${t}/primitives/${o.index}`,i,e,s,o,l=>{e._babylonTransformNode=l,e._primitiveBabylonMeshes=[l]}))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,e._babylonTransformNode=new K(i,this._babylonScene),e._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e._primitiveBabylonMeshes=[];for(const o of r)a.push(this._loadMeshPrimitiveAsync(`${t}/primitives/${o.index}`,`${i}_primitive${o.index}`,e,s,o,l=>{l.parent=e._babylonTransformNode,e._primitiveBabylonMeshes.push(l)}))}return n(e._babylonTransformNode),this.logClose(),Promise.all(a).then(()=>e._babylonTransformNode)}_loadMeshPrimitiveAsync(t,e,s,n,r,a){const i=this._extensionsLoadMeshPrimitiveAsync(t,e,s,n,r,a);if(i)return i;this.logOpen(`${t}`);const o=this._disableInstancedMesh===0&&this._parent.createInstances&&s.skin==null&&!n.primitives[0].targets;let l,h;if(o&&r._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,l=r._instanceData.babylonSourceMesh.createInstance(e),l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h=r._instanceData.promise;else{const d=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const c=new J(e,this._babylonScene);if(c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c.sideOrientation=this._babylonScene.useRightHandedSystem?S.CounterClockWiseSideOrientation:S.ClockWiseSideOrientation,this._createMorphTargets(t,s,n,r,c),d.push(this._loadVertexDataAsync(t,r,c).then(async p=>await this._loadMorphTargetsAsync(t,r,c,p).then(()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,p.applyToMesh(c),p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)}))),!this.parent.skipMaterials){const p=y._GetDrawMode(t,r.mode);if(r.material==null){let _=this._defaultBabylonMaterialData[p];_||(_=this._createDefaultMaterial("__GLTFLoader._default",p),this._parent.onMaterialLoadedObservable.notifyObservers(_),this._defaultBabylonMaterialData[p]=_),c.material=_}else{const _=f.Get(`${t}/material`,this._gltf.materials,r.material);d.push(this._loadMaterialAsync(`/materials/${_.index}`,_,c,p,v=>{c.material=v}))}}h=Promise.all(d),o&&(r._instanceData={babylonSourceMesh:c,promise:h}),l=c}return y.AddPointerMetadata(l,t),this._parent.onMeshLoadedObservable.notifyObservers(l),a(l),this.logClose(),h.then(()=>l)}_loadVertexDataAsync(t,e,s){const n=this._extensionsLoadVertexDataAsync(t,e,s);if(n)return n;const r=e.attributes;if(!r)throw new Error(`${t}: Attributes are missing`);const a=new Array,i=new ce(s.name,this._babylonScene);if(e.indices==null)s.isUnIndexed=!0;else{const l=f.Get(`${t}/indices`,this._gltf.accessors,e.indices);a.push(this._loadIndicesAccessorAsync(`/accessors/${l.index}`,l).then(h=>{i.setIndices(h)}))}const o=(l,h,d)=>{if(r[l]==null)return;s._delayInfo=s._delayInfo||[],s._delayInfo.indexOf(h)===-1&&s._delayInfo.push(h);const c=f.Get(`${t}/attributes/${l}`,this._gltf.accessors,r[l]);a.push(this._loadVertexAccessorAsync(`/accessors/${c.index}`,c,h).then(p=>{if(p.getKind()===m.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!s.skeleton){const _=Y(c);_&&(i._boundingInfo=_,i.useBoundingInfoFromGeometry=!0)}i.setVerticesBuffer(p,c.count)})),h==m.MatricesIndicesExtraKind&&(s.numBoneInfluencers=8),d&&d(c)};return o("POSITION",m.PositionKind),o("NORMAL",m.NormalKind),o("TANGENT",m.TangentKind),o("TEXCOORD_0",m.UVKind),o("TEXCOORD_1",m.UV2Kind),o("TEXCOORD_2",m.UV3Kind),o("TEXCOORD_3",m.UV4Kind),o("TEXCOORD_4",m.UV5Kind),o("TEXCOORD_5",m.UV6Kind),o("JOINTS_0",m.MatricesIndicesKind),o("WEIGHTS_0",m.MatricesWeightsKind),o("JOINTS_1",m.MatricesIndicesExtraKind),o("WEIGHTS_1",m.MatricesWeightsExtraKind),o("COLOR_0",m.ColorKind,l=>{l.type==="VEC4"&&(s.hasVertexAlpha=!0)}),Promise.all(a).then(()=>i)}_createMorphTargets(t,e,s,n,r){if(!n.targets||!this._parent.loadMorphTargets)return;if(e._numMorphTargets==null)e._numMorphTargets=n.targets.length;else if(n.targets.length!==e._numMorphTargets)throw new Error(`${t}: Primitives do not have the same number of targets`);const a=s.extras?s.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,r.morphTargetManager=new ue(this._babylonScene),r.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r.morphTargetManager.areUpdatesFrozen=!0;for(let i=0;i<n.targets.length;i++){const o=e.weights?e.weights[i]:s.weights?s.weights[i]:0,l=a?a[i]:`morphTarget${i}`;r.morphTargetManager.addTarget(new fe(l,o,r.getScene()))}}_loadMorphTargetsAsync(t,e,s,n){if(!e.targets||!this._parent.loadMorphTargets)return Promise.resolve();const r=new Array,a=s.morphTargetManager;for(let i=0;i<a.numTargets;i++){const o=a.getTarget(i);r.push(this._loadMorphTargetVertexDataAsync(`${t}/targets/${i}`,n,e.targets[i],o))}return Promise.all(r).then(()=>{a.areUpdatesFrozen=!1})}async _loadMorphTargetVertexDataAsync(t,e,s,n){const r=new Array,a=(i,o,l)=>{if(s[i]==null)return;const h=e.getVertexBuffer(o);if(!h)return;const d=f.Get(`${t}/${i}`,this._gltf.accessors,s[i]);r.push(this._loadFloatAccessorAsync(`/accessors/${d.index}`,d).then(c=>{l(h,c)}))};return a("POSITION",m.PositionKind,(i,o)=>{const l=new Float32Array(o.length);i.forEach(o.length,(h,d)=>{l[d]=o[d]+h}),n.setPositions(l)}),a("NORMAL",m.NormalKind,(i,o)=>{const l=new Float32Array(o.length);i.forEach(l.length,(h,d)=>{l[d]=o[d]+h}),n.setNormals(l)}),a("TANGENT",m.TangentKind,(i,o)=>{const l=new Float32Array(o.length/3*4);let h=0;i.forEach(o.length/3*4,(d,c)=>{(c+1)%4!==0&&(l[h]=o[h]+d,h++)}),n.setTangents(l)}),a("TEXCOORD_0",m.UVKind,(i,o)=>{const l=new Float32Array(o.length);i.forEach(o.length,(h,d)=>{l[d]=o[d]+h}),n.setUVs(l)}),a("TEXCOORD_1",m.UV2Kind,(i,o)=>{const l=new Float32Array(o.length);i.forEach(o.length,(h,d)=>{l[d]=o[d]+h}),n.setUV2s(l)}),a("COLOR_0",m.ColorKind,(i,o)=>{let l=null;const h=i.getSize();if(h===3){l=new Float32Array(o.length/3*4),i.forEach(o.length,(d,c)=>{const p=Math.floor(c/3),_=c%3;l[4*p+_]=o[3*p+_]+d});for(let d=0;d<o.length/3;++d)l[4*d+3]=1}else if(h===4)l=new Float32Array(o.length),i.forEach(o.length,(d,c)=>{l[c]=o[c]+d});else throw new Error(`${t}: Invalid number of components (${h}) for COLOR_0 attribute`);n.setColors(l)}),await Promise.all(r).then(()=>{})}static _LoadTransform(t,e){if(t.skin!=null)return;let s=P.Zero(),n=F.Identity(),r=P.One();t.matrix?R.FromArray(t.matrix).decompose(r,n,s):(t.translation&&(s=P.FromArray(t.translation)),t.rotation&&(n=F.FromArray(t.rotation)),t.scale&&(r=P.FromArray(t.scale))),e.position=s,e.rotationQuaternion=n,e.scaling=r}_loadSkinAsync(t,e,s,n){if(!this._parent.loadSkins)return Promise.resolve();const r=this._extensionsLoadSkinAsync(t,e,s);if(r)return r;if(s._data)return n(s._data.babylonSkeleton),s._data.promise;const a=`skeleton${s.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new _e(s.name||a,a,this._babylonScene);i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(t,s,i);const o=this._loadSkinInverseBindMatricesDataAsync(t,s).then(l=>{this._updateBoneMatrices(i,l)});return s._data={babylonSkeleton:i,promise:o},n(i),o}_loadBones(t,e,s){if(e.skeleton==null||this._parent.alwaysComputeSkeletonRootNode){const r=this._findSkeletonRootNode(`${t}/joints`,e.joints);if(r)if(e.skeleton===void 0)e.skeleton=r.index;else{const a=(o,l)=>{for(;l.parent;l=l.parent)if(l.parent===o)return!0;return!1},i=f.Get(`${t}/skeleton`,this._gltf.nodes,e.skeleton);i!==r&&!a(i,r)&&(C.Warn(`${t}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),e.skeleton=r.index)}else C.Warn(`${t}: Failed to find common root`)}const n={};for(const r of e.joints){const a=f.Get(`${t}/joints/${r}`,this._gltf.nodes,r);this._loadBone(a,e,s,n)}}_findSkeletonRootNode(t,e){if(e.length===0)return null;const s={};for(const r of e){const a=[];let i=f.Get(`${t}/${r}`,this._gltf.nodes,r);for(;i.index!==-1;)a.unshift(i),i=i.parent;s[r]=a}let n=null;for(let r=0;;++r){let a=s[e[0]];if(r>=a.length)return n;const i=a[r];for(let o=1;o<e.length;++o)if(a=s[e[o]],r>=a.length||i!==a[r])return n;n=i}}_loadBone(t,e,s,n){t._isJoint=!0;let r=n[t.index];if(r)return r;let a=null;t.index!==e.skeleton&&(t.parent&&t.parent.index!==-1?a=this._loadBone(t.parent,e,s,n):e.skeleton!==void 0&&C.Warn(`/skins/${e.index}/skeleton: Skeleton node is not a common root`));const i=e.joints.indexOf(t.index);return r=new pe(t.name||`joint${t.index}`,s,a,this._getNodeMatrix(t),null,null,i),n[t.index]=r,this._postSceneLoadActions.push(()=>{r.linkTransformNode(t._babylonTransformNode)}),r}_loadSkinInverseBindMatricesDataAsync(t,e){if(e.inverseBindMatrices==null)return Promise.resolve(null);const s=f.Get(`${t}/inverseBindMatrices`,this._gltf.accessors,e.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${s.index}`,s)}_updateBoneMatrices(t,e){for(const s of t.bones){const n=R.Identity(),r=s._index;e&&r!==-1&&(R.FromArrayToRef(e,r*16,n),n.invertToRef(n));const a=s.getParent();a&&n.multiplyToRef(a.getAbsoluteInverseBindMatrix(),n),s.updateMatrix(n,!1,!1),s._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(t){return t.matrix?R.FromArray(t.matrix):R.Compose(t.scale?P.FromArray(t.scale):P.One(),t.rotation?F.FromArray(t.rotation):F.Identity(),t.translation?P.FromArray(t.translation):P.Zero())}loadCameraAsync(t,e,s=()=>{}){const n=this._extensionsLoadCameraAsync(t,e,s);if(n)return n;const r=new Array;this.logOpen(`${t} ${e.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const a=new me(e.name||`camera${e.index}`,P.Zero(),this._babylonScene,!1);switch(a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e._babylonCamera=a,a.setTarget(new P(0,0,-1)),e.type){case"perspective":{const i=e.perspective;if(!i)throw new Error(`${t}: Camera perspective properties are missing`);a.fov=i.yfov,a.minZ=i.znear,a.maxZ=i.zfar||0;break}case"orthographic":{if(!e.orthographic)throw new Error(`${t}: Camera orthographic properties are missing`);a.mode=ye.ORTHOGRAPHIC_CAMERA,a.orthoLeft=-e.orthographic.xmag,a.orthoRight=e.orthographic.xmag,a.orthoBottom=-e.orthographic.ymag,a.orthoTop=e.orthographic.ymag,a.minZ=e.orthographic.znear,a.maxZ=e.orthographic.zfar;break}default:throw new Error(`${t}: Invalid camera type (${e.type})`)}return y.AddPointerMetadata(a,t),this._parent.onCameraLoadedObservable.notifyObservers(a),s(a),this.logClose(),Promise.all(r).then(()=>a)}_loadAnimationsAsync(){this._parent._startPerformanceCounter("Load animations");const t=this._gltf.animations;if(!t)return Promise.resolve();const e=new Array;for(let s=0;s<t.length;s++){const n=t[s];e.push(this.loadAnimationAsync(`/animations/${n.index}`,n).then(r=>{r.targetedAnimations.length===0&&r.dispose()}))}return Promise.all(e).then(()=>{this._parent._endPerformanceCounter("Load animations")})}loadAnimationAsync(t,e){this._parent._startPerformanceCounter("Load animation");const s=this._extensionsLoadAnimationAsync(t,e);return s||Pe.value.then(({AnimationGroup:n})=>{this._babylonScene._blockEntityCollection=!!this._assetContainer;const r=new n(e.name||`animation${e.index}`,this._babylonScene);r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e._babylonAnimationGroup=r;const a=new Array;f.Assign(e.channels),f.Assign(e.samplers);for(const i of e.channels)a.push(this._loadAnimationChannelAsync(`${t}/channels/${i.index}`,t,e,i,(o,l)=>{o.animations=o.animations||[],o.animations.push(l),r.addTargetedAnimation(l,o)}));return this._parent._endPerformanceCounter("Load animation"),Promise.all(a).then(()=>(r.normalize(0),r))})}_loadAnimationChannelAsync(t,e,s,n,r){const a=this._extensionsLoadAnimationChannelAsync(t,e,s,n,r);if(a)return a;if(n.target.node==null)return Promise.resolve();const i=f.Get(`${t}/target/node`,this._gltf.nodes,n.target.node),o=n.target.path,l=o==="weights";return l&&!i._numMorphTargets||!l&&!i._babylonTransformNode||!this._parent.loadNodeAnimations&&!l&&!i._isJoint?Promise.resolve():Te.value.then(()=>{let h;switch(o){case"translation":{h=G("/nodes/{}/translation")?.interpolation;break}case"rotation":{h=G("/nodes/{}/rotation")?.interpolation;break}case"scale":{h=G("/nodes/{}/scale")?.interpolation;break}case"weights":{h=G("/nodes/{}/weights")?.interpolation;break}default:throw new Error(`${t}/target/path: Invalid value (${n.target.path})`)}if(!h)throw new Error(`${t}/target/path: Could not find interpolation properties for target path (${n.target.path})`);const d={object:i,info:h};return this._loadAnimationChannelFromTargetInfoAsync(t,e,s,n,d,r)})}_loadAnimationChannelFromTargetInfoAsync(t,e,s,n,r,a){const i=this.parent.targetFps,o=1/i,l=f.Get(`${t}/sampler`,s.samplers,n.sampler);return this._loadAnimationSamplerAsync(`${e}/samplers/${n.sampler}`,l).then(h=>{let d=0;const c=r.object,p=r.info;for(const _ of p){const v=_.getStride(c),g=h.input,L=h.output,x=new Array(g.length);let M=0;switch(h.interpolation){case"STEP":{for(let b=0;b<g.length;b++){const $=_.getValue(c,L,M,1);M+=v,x[b]={frame:g[b]*i,value:$,interpolation:1}}break}case"CUBICSPLINE":{for(let b=0;b<g.length;b++){const $=_.getValue(c,L,M,o);M+=v;const k=_.getValue(c,L,M,1);M+=v;const ee=_.getValue(c,L,M,o);M+=v,x[b]={frame:g[b]*i,inTangent:$,value:k,outTangent:ee}}break}case"LINEAR":{for(let b=0;b<g.length;b++){const $=_.getValue(c,L,M,1);M+=v,x[b]={frame:g[b]*i,value:$}}break}}if(M>0){const b=`${s.name||`animation${s.index}`}_channel${n.index}_${d}`,$=_.buildAnimations(c,b,i,x);for(const k of $)d++,a(k.babylonAnimatable,k.babylonAnimation)}}})}_loadAnimationSamplerAsync(t,e){if(e._data)return e._data;const s=e.interpolation||"LINEAR";switch(s){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${t}/interpolation: Invalid value (${e.interpolation})`)}const n=f.Get(`${t}/input`,this._gltf.accessors,e.input),r=f.Get(`${t}/output`,this._gltf.accessors,e.output);return e._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${n.index}`,n),this._loadFloatAccessorAsync(`/accessors/${r.index}`,r)]).then(([a,i])=>({input:a,interpolation:s,output:i})),e._data}loadBufferAsync(t,e,s,n){const r=this._extensionsLoadBufferAsync(t,e,s,n);if(r)return r;if(!e._data)if(e.uri)e._data=this.loadUriAsync(`${t}/uri`,e,e.uri);else{if(!this._bin)throw new Error(`${t}: Uri is missing or the binary glTF is missing its binary chunk`);e._data=this._bin.readAsync(0,e.byteLength)}return e._data.then(a=>{try{return new Uint8Array(a.buffer,a.byteOffset+s,n)}catch(i){throw new Error(`${t}: ${i.message}`)}})}loadBufferViewAsync(t,e){const s=this._extensionsLoadBufferViewAsync(t,e);if(s)return s;if(e._data)return e._data;const n=f.Get(`${t}/buffer`,this._gltf.buffers,e.buffer);return e._data=this.loadBufferAsync(`/buffers/${n.index}`,n,e.byteOffset||0,e.byteLength),e._data}_loadAccessorAsync(t,e,s){if(e._data)return e._data;const n=y._GetNumComponents(t,e.type),r=n*m.GetTypeByteLength(e.componentType),a=n*e.count;if(e.bufferView==null)e._data=Promise.resolve(new s(a));else{const i=f.Get(`${t}/bufferView`,this._gltf.bufferViews,e.bufferView);e._data=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i).then(o=>{if(e.componentType===5126&&!e.normalized&&(!i.byteStride||i.byteStride===r))return y._GetTypedArray(t,e.componentType,o,e.byteOffset,a);{const l=new s(a);return m.ForEach(o,e.byteOffset||0,i.byteStride||r,n,e.componentType,l.length,e.normalized||!1,(h,d)=>{l[d]=h}),l}})}if(e.sparse){const i=e.sparse;e._data=e._data.then(o=>{const l=o,h=f.Get(`${t}/sparse/indices/bufferView`,this._gltf.bufferViews,i.indices.bufferView),d=f.Get(`${t}/sparse/values/bufferView`,this._gltf.bufferViews,i.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${h.index}`,h),this.loadBufferViewAsync(`/bufferViews/${d.index}`,d)]).then(([c,p])=>{const _=y._GetTypedArray(`${t}/sparse/indices`,i.indices.componentType,c,i.indices.byteOffset,i.count),v=n*i.count;let g;if(e.componentType===5126&&!e.normalized)g=y._GetTypedArray(`${t}/sparse/values`,e.componentType,p,i.values.byteOffset,v);else{const x=y._GetTypedArray(`${t}/sparse/values`,e.componentType,p,i.values.byteOffset,v);g=new s(v),m.ForEach(x,0,r,n,e.componentType,g.length,e.normalized||!1,(M,b)=>{g[b]=M})}let L=0;for(let x=0;x<_.length;x++){let M=_[x]*n;for(let b=0;b<n;b++)l[M++]=g[L++]}return l})})}return e._data}_loadFloatAccessorAsync(t,e){return this._loadAccessorAsync(t,e,Float32Array)}_loadIndicesAccessorAsync(t,e){if(e.type!=="SCALAR")throw new Error(`${t}/type: Invalid value ${e.type}`);if(e.componentType!==5121&&e.componentType!==5123&&e.componentType!==5125)throw new Error(`${t}/componentType: Invalid value ${e.componentType}`);if(e._data)return e._data;if(e.sparse){const s=y._GetTypedArrayConstructor(`${t}/componentType`,e.componentType);e._data=this._loadAccessorAsync(t,e,s)}else{const s=f.Get(`${t}/bufferView`,this._gltf.bufferViews,e.bufferView);e._data=this.loadBufferViewAsync(`/bufferViews/${s.index}`,s).then(n=>y._GetTypedArray(t,e.componentType,n,e.byteOffset,e.count))}return e._data}_loadVertexBufferViewAsync(t){if(t._babylonBuffer)return t._babylonBuffer;const e=this._babylonScene.getEngine();return t._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${t.index}`,t).then(s=>new be(e,s,!1)),t._babylonBuffer}_loadVertexAccessorAsync(t,e,s){if(e._babylonVertexBuffer?.[s])return e._babylonVertexBuffer[s];e._babylonVertexBuffer||(e._babylonVertexBuffer={});const n=this._babylonScene.getEngine();if(e.sparse||e.bufferView==null)e._babylonVertexBuffer[s]=this._loadFloatAccessorAsync(t,e).then(r=>new m(n,r,s,!1));else{const r=f.Get(`${t}/bufferView`,this._gltf.bufferViews,e.bufferView);e._babylonVertexBuffer[s]=this._loadVertexBufferViewAsync(r).then(a=>{const i=y._GetNumComponents(t,e.type);return new m(n,a,s,!1,void 0,r.byteStride,void 0,e.byteOffset,i,e.componentType,e.normalized,!0,void 0,!0)})}return e._babylonVertexBuffer[s]}_loadMaterialMetallicRoughnessPropertiesAsync(t,e,s){const n=new Array,r=this._getOrCreateMaterialAdapter(s);return e&&(e.baseColorFactor?(r.baseColor=U.FromArray(e.baseColorFactor),r.geometryOpacity=e.baseColorFactor[3]):r.baseColor=U.White(),r.baseMetalness=e.metallicFactor==null?1:e.metallicFactor,r.specularRoughness=e.roughnessFactor==null?1:e.roughnessFactor,e.baseColorTexture&&n.push(this.loadTextureInfoAsync(`${t}/baseColorTexture`,e.baseColorTexture,a=>{a.name=`${s.name} (Base Color)`,r.baseColorTexture=a})),e.metallicRoughnessTexture&&(e.metallicRoughnessTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${t}/metallicRoughnessTexture`,e.metallicRoughnessTexture,a=>{a.name=`${s.name} (Metallic Roughness)`,r.baseMetalnessTexture=a,r.specularRoughnessTexture=a})),r.useRoughnessFromMetallicTextureGreen=!0,r.useMetallicFromMetallicTextureBlue=!0)),Promise.all(n).then(()=>{})}_loadMaterialAsync(t,e,s,n,r=()=>{}){const a=this._extensionsLoadMaterialAsync(t,e,s,n,r);if(a)return a;e._data=e._data||{};let i=e._data[n];if(!i){this.logOpen(`${t} ${e.name||""}`);const o=this.createMaterial(t,e,n);i={babylonMaterial:o,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(t,e,o)},e._data[n]=i,y.AddPointerMetadata(o,t),this._parent.onMaterialLoadedObservable.notifyObservers(o),this.logClose()}return s&&(i.babylonMeshes.push(s),s.onDisposeObservable.addOnce(()=>{const o=i.babylonMeshes.indexOf(s);o!==-1&&i.babylonMeshes.splice(o,1)})),r(i.babylonMaterial),i.promise.then(()=>i.babylonMaterial)}_createDefaultMaterial(t,e){if(!this._pbrMaterialImpl)throw new Error("PBR Material class not loaded");this._babylonScene._blockEntityCollection=!!this._assetContainer;const s=new this._pbrMaterialImpl.materialClass(t,this._babylonScene);s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,s.fillMode=e,s.transparencyMode=this._pbrMaterialImpl.materialClass.MATERIAL_OPAQUE;const n=this._getOrCreateMaterialAdapter(s);return n.transparencyAsAlphaCoverage=this._parent.transparencyAsCoverage,n.baseMetalness=1,n.specularRoughness=1,s}createMaterial(t,e,s){const n=this._extensionsCreateMaterial(t,e,s);if(n)return n;const r=e.name||`material${e.index}`;return this._createDefaultMaterial(r,s)}loadMaterialPropertiesAsync(t,e,s){const n=this._extensionsLoadMaterialPropertiesAsync(t,e,s);if(n)return n;const r=new Array;return r.push(this.loadMaterialBasePropertiesAsync(t,e,s)),e.pbrMetallicRoughness&&r.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${t}/pbrMetallicRoughness`,e.pbrMetallicRoughness,s)),this.loadMaterialAlphaProperties(t,e,s),Promise.all(r).then(()=>{})}loadMaterialBasePropertiesAsync(t,e,s){const n=new Array,r=this._getOrCreateMaterialAdapter(s);r.emissionColor=e.emissiveFactor?U.FromArray(e.emissiveFactor):new U(0,0,0),e.doubleSided&&(r.backFaceCulling=!1,r.twoSidedLighting=!0),e.normalTexture&&(e.normalTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${t}/normalTexture`,e.normalTexture,l=>{l.name=`${s.name} (Normal)`,r.geometryNormalTexture=l,e.normalTexture?.scale!=null&&(l.level=e.normalTexture.scale)})),r.setNormalMapInversions(!this._babylonScene.useRightHandedSystem,this._babylonScene.useRightHandedSystem));let a,i=1,o;return e.occlusionTexture&&(e.occlusionTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${t}/occlusionTexture`,e.occlusionTexture,l=>{l.name=`${s.name} (Occlusion)`,a=l})),e.occlusionTexture.strength!=null&&(i=e.occlusionTexture.strength)),e.emissiveTexture&&n.push(this.loadTextureInfoAsync(`${t}/emissiveTexture`,e.emissiveTexture,l=>{l.name=`${s.name} (Emissive)`,o=l})),Promise.all(n).then(()=>{a&&(r.ambientOcclusionTexture=a,r.ambientOcclusionTextureStrength=i),o&&(r.emissionColorTexture=o)})}loadMaterialAlphaProperties(t,e,s){if(!this._pbrMaterialImpl)throw new Error(`${t}: Material type not supported`);const n=this._getOrCreateMaterialAdapter(s),r=n.baseColorTexture;switch(e.alphaMode||"OPAQUE"){case"OPAQUE":{s.transparencyMode=this._pbrMaterialImpl.materialClass.MATERIAL_OPAQUE,s.alpha=1;break}case"MASK":{s.transparencyMode=this._pbrMaterialImpl.materialClass.MATERIAL_ALPHATEST,n.alphaCutOff=e.alphaCutoff==null?.5:e.alphaCutoff,r&&(r.hasAlpha=!0);break}case"BLEND":{s.transparencyMode=this._pbrMaterialImpl.materialClass.MATERIAL_ALPHABLEND,r&&(r.hasAlpha=!0,n.useAlphaFromBaseColorTexture=!0);break}default:throw new Error(`${t}/alphaMode: Invalid value (${e.alphaMode})`)}}loadTextureInfoAsync(t,e,s=()=>{}){const n=this._extensionsLoadTextureInfoAsync(t,e,s);if(n)return n;if(this.logOpen(`${t}`),e.texCoord>=6)throw new Error(`${t}/texCoord: Invalid value (${e.texCoord})`);const r=f.Get(`${t}/index`,this._gltf.textures,e.index);r._textureInfo=e;const a=this._loadTextureAsync(`/textures/${e.index}`,r,i=>{i.coordinatesIndex=e.texCoord||0,y.AddPointerMetadata(i,t),this._parent.onTextureLoadedObservable.notifyObservers(i),s(i)});return this.logClose(),a}_loadTextureAsync(t,e,s=()=>{}){const n=this._extensionsLoadTextureAsync(t,e,s);if(n)return n;this.logOpen(`${t} ${e.name||""}`);const r=e.sampler==null?y.DefaultSampler:f.Get(`${t}/sampler`,this._gltf.samplers,e.sampler),a=f.Get(`${t}/source`,this._gltf.images,e.source),i=this._createTextureAsync(t,r,a,s,void 0,!e._textureInfo.nonColorData);return this.logClose(),i}_createTextureAsync(t,e,s,n=()=>{},r,a){const i=this._loadSampler(`/samplers/${e.index}`,e),o=new Array,l=new Ee;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h={noMipmap:i.noMipMaps,invertY:!1,samplingMode:i.samplingMode,onLoad:()=>{this._disposed||l.resolve()},onError:(c,p)=>{this._disposed||l.reject(new Error(`${t}: ${p&&p.message?p.message:c||"Failed to load texture"}`))},mimeType:s.mimeType??ge(s.uri??""),loaderOptions:r,useSRGBBuffer:!!a&&this._parent.useSRGBBuffers},d=new A(null,this._babylonScene,h);return d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.push(l.promise),o.push(this.loadImageAsync(`/images/${s.index}`,s).then(c=>{const p=s.uri||`${this._fileName}#image${s.index}`,_=`data:${this._uniqueRootUrl}${p}`;d.updateURL(_,c);const v=d.getInternalTexture();v&&(v.label=s.name)})),d.wrapU=i.wrapU,d.wrapV=i.wrapV,n(d),this._parent.useGltfTextureNames&&(d.name=s.name||s.uri||`image${s.index}`),Promise.all(o).then(()=>d)}_loadSampler(t,e){return e._data||(e._data={noMipMaps:e.minFilter===9728||e.minFilter===9729,samplingMode:y._GetTextureSamplingMode(t,e),wrapU:y._GetTextureWrapMode(`${t}/wrapS`,e.wrapS),wrapV:y._GetTextureWrapMode(`${t}/wrapT`,e.wrapT)}),e._data}loadImageAsync(t,e){if(!e._data){if(this.logOpen(`${t} ${e.name||""}`),e.uri)e._data=this.loadUriAsync(`${t}/uri`,e,e.uri);else{const s=f.Get(`${t}/bufferView`,this._gltf.bufferViews,e.bufferView);e._data=this.loadBufferViewAsync(`/bufferViews/${s.index}`,s)}this.logClose()}return e._data}loadUriAsync(t,e,s){const n=this._extensionsLoadUriAsync(t,e,s);if(n)return n;if(!y._ValidateUri(s))throw new Error(`${t}: '${s}' is invalid`);if(Ae(s)){const r=new Uint8Array(z(s));return this.log(`${t}: Decoded ${s.substring(0,64)}... (${r.length} bytes)`),Promise.resolve(r)}return this.log(`${t}: Loading ${s}`),this._parent.preprocessUrlAsync(this._rootUrl+s).then(r=>new Promise((a,i)=>{this._parent._loadFile(this._babylonScene,r,o=>{this._disposed||(this.log(`${t}: Loaded ${s} (${o.byteLength} bytes)`),a(new Uint8Array(o)))},!0,o=>{i(new ve(`${t}: Failed to load '${s}'${o?": "+o.status+" "+o.statusText:""}`,o))})}))}static AddPointerMetadata(t,e){t.metadata=t.metadata||{};const s=t._internalMetadata=t._internalMetadata||{},n=s.gltf=s.gltf||{};(n.pointers=n.pointers||[]).push(e)}static _GetTextureWrapMode(t,e){switch(e=e??10497,e){case 33071:return A.CLAMP_ADDRESSMODE;case 33648:return A.MIRROR_ADDRESSMODE;case 10497:return A.WRAP_ADDRESSMODE;default:return C.Warn(`${t}: Invalid value (${e})`),A.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(t,e){const s=e.magFilter==null?9729:e.magFilter,n=e.minFilter==null?9987:e.minFilter;if(s===9729)switch(n){case 9728:return A.LINEAR_NEAREST;case 9729:return A.LINEAR_LINEAR;case 9984:return A.LINEAR_NEAREST_MIPNEAREST;case 9985:return A.LINEAR_LINEAR_MIPNEAREST;case 9986:return A.LINEAR_NEAREST_MIPLINEAR;case 9987:return A.LINEAR_LINEAR_MIPLINEAR;default:return C.Warn(`${t}/minFilter: Invalid value (${n})`),A.LINEAR_LINEAR_MIPLINEAR}else switch(s!==9728&&C.Warn(`${t}/magFilter: Invalid value (${s})`),n){case 9728:return A.NEAREST_NEAREST;case 9729:return A.NEAREST_LINEAR;case 9984:return A.NEAREST_NEAREST_MIPNEAREST;case 9985:return A.NEAREST_LINEAR_MIPNEAREST;case 9986:return A.NEAREST_NEAREST_MIPLINEAR;case 9987:return A.NEAREST_LINEAR_MIPLINEAR;default:return C.Warn(`${t}/minFilter: Invalid value (${n})`),A.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(t,e){try{return Ce(e)}catch(s){throw new Error(`${t}: ${s.message}`)}}static _GetTypedArray(t,e,s,n,r){const a=s.buffer;n=s.byteOffset+(n||0);const i=y._GetTypedArrayConstructor(`${t}/componentType`,e),o=m.GetTypeByteLength(e);return n%o!==0?(C.Warn(`${t}: Copying buffer as byte offset (${n}) is not a multiple of component type byte length (${o})`),new i(a.slice(n,n+r*o),0)):new i(a,n,r)}static _GetNumComponents(t,e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":return 4;case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${t}: Invalid type (${e})`)}static _ValidateUri(t){return T.IsBase64(t)||t.indexOf("..")===-1}static _GetDrawMode(t,e){switch(e==null&&(e=4),e){case 0:return S.PointListDrawMode;case 1:return S.LineListDrawMode;case 2:return S.LineLoopDrawMode;case 3:return S.LineStripDrawMode;case 4:return S.TriangleFillMode;case 5:return S.TriangleStripDrawMode;case 6:return S.TriangleFanDrawMode}throw new Error(`${t}: Invalid mesh primitive mode (${e})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const t=new Array;if(this._gltf.materials){for(const e of this._gltf.materials)if(e._data)for(const s in e._data){const n=e._data[s];for(const r of n.babylonMeshes){r.computeWorldMatrix(!0);const a=n.babylonMaterial;t.push(a.forceCompilationAsync(r)),t.push(a.forceCompilationAsync(r,{useInstances:!0})),this._parent.useClipPlane&&(t.push(a.forceCompilationAsync(r,{clipPlane:!0})),t.push(a.forceCompilationAsync(r,{clipPlane:!0,useInstances:!0})))}}}return Promise.all(t).then(()=>{this._parent._endPerformanceCounter("Compile materials")})}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const t=new Array,e=this._babylonScene.lights;for(const s of e){const n=s.getShadowGenerator();n&&t.push(n.forceCompilationAsync())}return Promise.all(t).then(()=>{this._parent._endPerformanceCounter("Compile shadow generators")})}_forEachExtensions(t){for(const e of this._extensions)e.enabled&&t(e)}_applyExtensions(t,e,s){for(const n of this._extensions)if(n.enabled){const r=`${n.name}.${e}`,a=t;a._activeLoaderExtensionFunctions=a._activeLoaderExtensionFunctions||{};const i=a._activeLoaderExtensionFunctions;if(!i[r]){i[r]=!0;try{const o=s(n);if(o)return o}finally{delete i[r]}}}return null}_extensionsOnLoading(){this._forEachExtensions(t=>t.onLoading&&t.onLoading())}_extensionsOnReady(){this._forEachExtensions(t=>t.onReady&&t.onReady())}_extensionsLoadSceneAsync(t,e){return this._applyExtensions(e,"loadScene",s=>s.loadSceneAsync&&s.loadSceneAsync(t,e))}_extensionsLoadNodeAsync(t,e,s){return this._applyExtensions(e,"loadNode",n=>n.loadNodeAsync&&n.loadNodeAsync(t,e,s))}_extensionsLoadCameraAsync(t,e,s){return this._applyExtensions(e,"loadCamera",n=>n.loadCameraAsync&&n.loadCameraAsync(t,e,s))}_extensionsLoadVertexDataAsync(t,e,s){return this._applyExtensions(e,"loadVertexData",n=>n._loadVertexDataAsync&&n._loadVertexDataAsync(t,e,s))}_extensionsLoadMeshPrimitiveAsync(t,e,s,n,r,a){return this._applyExtensions(r,"loadMeshPrimitive",i=>i._loadMeshPrimitiveAsync&&i._loadMeshPrimitiveAsync(t,e,s,n,r,a))}_extensionsLoadMaterialAsync(t,e,s,n,r){return this._applyExtensions(e,"loadMaterial",a=>a._loadMaterialAsync&&a._loadMaterialAsync(t,e,s,n,r))}_extensionsCreateMaterial(t,e,s){return this._applyExtensions(e,"createMaterial",n=>n.createMaterial&&n.createMaterial(t,e,s))}_extensionsLoadMaterialPropertiesAsync(t,e,s){return this._applyExtensions(e,"loadMaterialProperties",n=>n.loadMaterialPropertiesAsync&&n.loadMaterialPropertiesAsync(t,e,s))}_extensionsLoadTextureInfoAsync(t,e,s){return this._applyExtensions(e,"loadTextureInfo",n=>n.loadTextureInfoAsync&&n.loadTextureInfoAsync(t,e,s))}_extensionsLoadTextureAsync(t,e,s){return this._applyExtensions(e,"loadTexture",n=>n._loadTextureAsync&&n._loadTextureAsync(t,e,s))}_extensionsLoadAnimationAsync(t,e){return this._applyExtensions(e,"loadAnimation",s=>s.loadAnimationAsync&&s.loadAnimationAsync(t,e))}_extensionsLoadAnimationChannelAsync(t,e,s,n,r){return this._applyExtensions(s,"loadAnimationChannel",a=>a._loadAnimationChannelAsync&&a._loadAnimationChannelAsync(t,e,s,n,r))}_extensionsLoadSkinAsync(t,e,s){return this._applyExtensions(s,"loadSkin",n=>n._loadSkinAsync&&n._loadSkinAsync(t,e,s))}_extensionsLoadUriAsync(t,e,s){return this._applyExtensions(e,"loadUri",n=>n._loadUriAsync&&n._loadUriAsync(t,e,s))}_extensionsLoadBufferViewAsync(t,e){return this._applyExtensions(e,"loadBufferView",s=>s.loadBufferViewAsync&&s.loadBufferViewAsync(t,e))}_extensionsLoadBufferAsync(t,e,s,n){return this._applyExtensions(e,"loadBuffer",r=>r.loadBufferAsync&&r.loadBufferAsync(t,e,s,n))}static LoadExtensionAsync(t,e,s,n){if(!e.extensions)return null;const a=e.extensions[s];return a?n(`${t}/extensions/${s}`,a):null}static LoadExtraAsync(t,e,s,n){if(!e.extras)return null;const a=e.extras[s];return a?n(`${t}/extras/${s}`,a):null}isExtensionUsed(t){return!!this._gltf.extensionsUsed&&this._gltf.extensionsUsed.indexOf(t)!==-1}logOpen(t){this._parent._logOpen(t)}logClose(){this._parent._logClose()}log(t){this._parent._log(t)}startPerformanceCounter(t){this._parent._startPerformanceCounter(t)}endPerformanceCounter(t){this._parent._endPerformanceCounter(t)}}y.DefaultSampler={index:-1};w._CreateGLTF2Loader=u=>new y(u);const Ie=Object.freeze(Object.defineProperty({__proto__:null,ArrayItem:f,GLTFFileLoader:w,GLTFLoader:y,LoadBoundingInfoFromPositionAccessor:Y},Symbol.toStringTag,{value:"Module"}));export{f as A,Ee as D,y as G,Y as L,Ie as g};
