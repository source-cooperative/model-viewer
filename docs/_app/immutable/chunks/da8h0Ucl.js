import{s as p,l as o,P as L,t as u,v as A,C as c,u as f,r as m}from"./C6i2Uxh4.js";import{A as _,G as g}from"./DQP14zVN.js";const a="KHR_lights_punctual";class w{constructor(n){this.name=a,this._loader=n,this.enabled=this._loader.isExtensionUsed(a)}dispose(){this._loader=null,delete this._lights}onLoading(){const n=this._loader.gltf.extensions;if(n&&n[this.name]){const s=n[this.name];this._lights=s.lights,_.Assign(this._lights)}}loadNodeAsync(n,s,b){return g.LoadExtensionAsync(n,s,this.name,async(l,y)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(n,s,r=>{let e;const t=_.Get(l,this._lights,y.light),h=t.name||r.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,t.type){case"directional":{const i=new u(h,o.Backward(),this._loader.babylonScene);i.position.setAll(0),e=i;break}case"point":{e=new L(h,o.Zero(),this._loader.babylonScene);break}case"spot":{const i=new p(h,o.Zero(),o.Backward(),0,1,this._loader.babylonScene);i.angle=(t.spot&&t.spot.outerConeAngle||Math.PI/4)*2,i.innerAngle=(t.spot&&t.spot.innerConeAngle||0)*2,e=i;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${l}: Invalid light type (${t.type})`)}e._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,t._babylonLight=e,e.falloffType=A.FALLOFF_GLTF,e.diffuse=t.color?c.FromArray(t.color):c.White(),e.intensity=t.intensity==null?1:t.intensity,e.range=t.range==null?Number.MAX_VALUE:t.range,e.parent=r,this._loader._babylonLights.push(e),g.AddPointerMetadata(e,l),b(r)})))}}f(a);m(a,!0,d=>new w(d));export{w as KHR_lights};
